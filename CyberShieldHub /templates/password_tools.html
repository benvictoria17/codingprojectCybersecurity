{% extends "layout.html" %}

{% block title %}Password Security Tools - CyberKidz{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow-sm animate__animated animate__fadeIn">
            <div class="card-body">
                <h1 class="card-title">
                    <i class="fas fa-key text-info me-2"></i> Password Security Tools
                </h1>
                <p class="lead">
                    Protect your accounts with strong passwords and check if your information has been leaked.
                </p>
                <div class="alert alert-primary">
                    <i class="fas fa-info-circle me-2"></i> These tools help you create strong passwords and check if your emails or passwords have been found in data breaches.
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i> Password Generator</h5>
            </div>
            <div class="card-body">
                <form id="password-generator-form">
                    <div class="mb-3">
                        <label for="passwordLength" class="form-label">Password Length</label>
                        <div class="d-flex align-items-center">
                            <input type="range" class="form-range flex-grow-1 me-2" id="passwordLength" min="8" max="32" value="12">
                            <span id="passwordLengthValue" class="badge bg-primary">12</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Character Types</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeUppercase" checked>
                            <label class="form-check-label" for="includeUppercase">
                                Uppercase Letters (ABC)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeLowercase" checked>
                            <label class="form-check-label" for="includeLowercase">
                                Lowercase Letters (abc)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeNumbers" checked>
                            <label class="form-check-label" for="includeNumbers">
                                Numbers (123)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeSymbols" checked>
                            <label class="form-check-label" for="includeSymbols">
                                Symbols (!@#)
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-magic me-2"></i> Generate Password
                        </button>
                    </div>
                </form>
                
                <div id="password-result" class="mt-4" style="display: none;">
                    <h6>Your Generated Password:</h6>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="generatedPassword" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="copyPassword">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div id="password-strength-meter" class="progress mb-2">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <p id="password-strength-text" class="small"></p>
                    <div id="password-feedback" class="small"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-comment me-2"></i> Passphrase Generator</h5>
            </div>
            <div class="card-body">
                <form id="passphrase-generator-form">
                    <div class="mb-3">
                        <label for="wordCount" class="form-label">Number of Words</label>
                        <div class="d-flex align-items-center">
                            <input type="range" class="form-range flex-grow-1 me-2" id="wordCount" min="3" max="8" value="4">
                            <span id="wordCountValue" class="badge bg-success">4</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="separator" class="form-label">Word Separator</label>
                        <select class="form-select" id="separator">
                            <option value="-">Hyphen (-)</option>
                            <option value=".">Period (.)</option>
                            <option value="_">Underscore (_)</option>
                            <option value=" ">Space</option>
                            <option value="">No Separator</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="capitalizeWords" checked>
                            <label class="form-check-label" for="capitalizeWords">
                                Capitalize Words
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeNumber" checked>
                            <label class="form-check-label" for="includeNumber">
                                Include a Number
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-paragraph me-2"></i> Generate Passphrase
                        </button>
                    </div>
                </form>
                
                <div id="passphrase-result" class="mt-4" style="display: none;">
                    <h6>Your Generated Passphrase:</h6>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="generatedPassphrase" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="copyPassphrase">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div id="passphrase-strength-meter" class="progress mb-2">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <p id="passphrase-strength-text" class="small"></p>
                    <div id="passphrase-feedback" class="small"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-search me-2"></i> Password & Email Leak Checker</h5>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs mb-3" id="leakCheckTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="password-tab" data-bs-toggle="tab" data-bs-target="#password-check" 
                                type="button" role="tab" aria-controls="password-check" aria-selected="true">
                            Check Password
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="email-tab" data-bs-toggle="tab" data-bs-target="#email-check" 
                                type="button" role="tab" aria-controls="email-check" aria-selected="false">
                            Check Email
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="leakCheckTabContent">
                    <div class="tab-pane fade show active" id="password-check" role="tabpanel" aria-labelledby="password-tab">
                        <p class="small mb-3">Check if your password has been found in data breaches. Your password is never sent over the internet - only a partial hash is used.</p>
                        
                        <form id="password-leak-form">
                            <div class="mb-3">
                                <label for="passwordToCheck" class="form-label">Password to Check</label>
                                <input type="password" class="form-control" id="passwordToCheck" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-search me-2"></i> Check Password
                                </button>
                            </div>
                        </form>
                        
                        <div id="password-leak-result" class="mt-4" style="display: none;"></div>
                    </div>
                    
                    <div class="tab-pane fade" id="email-check" role="tabpanel" aria-labelledby="email-tab">
                        <p class="small mb-3">Check if your email has appeared in known data breaches. This helps you know if you should change passwords for accounts using this email.</p>
                        
                        <form id="email-leak-form">
                            <div class="mb-3">
                                <label for="emailToCheck" class="form-label">Email to Check</label>
                                <input type="email" class="form-control" id="emailToCheck" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-search me-2"></i> Check Email
                                </button>
                            </div>
                        </form>
                        
                        <div id="email-leak-result" class="mt-4" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i> Password Security Education</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Tips for Strong Passwords</h5>
                        <ul>
                            <li>Use at least 12 characters, the longer the better</li>
                            <li>Mix uppercase and lowercase letters, numbers, and symbols</li>
                            <li>Don't use easily guessable information like birthdates or names</li>
                            <li>Don't use the same password for multiple accounts</li>
                            <li>Consider using a password manager to generate and store passwords</li>
                            <li>Change passwords regularly for important accounts</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5>What is a Data Breach?</h5>
                        <p>
                            A data breach happens when hackers break into a company's system and steal user information.
                            This can include usernames, passwords, email addresses, and even credit card information.
                        </p>
                        <p>
                            If your information was in a data breach, hackers might try to use it to:
                        </p>
                        <ul>
                            <li>Log into your accounts</li>
                            <li>Try the same password on other websites</li>
                            <li>Send you targeted phishing emails</li>
                        </ul>
                        <p>
                            That's why it's important to use different passwords for different accounts and check if your information has been leaked.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password Generator
    const passwordForm = document.getElementById('password-generator-form');
    const passwordLength = document.getElementById('passwordLength');
    const passwordLengthValue = document.getElementById('passwordLengthValue');
    const includeUppercase = document.getElementById('includeUppercase');
    const includeLowercase = document.getElementById('includeLowercase');
    const includeNumbers = document.getElementById('includeNumbers');
    const includeSymbols = document.getElementById('includeSymbols');
    const generatedPassword = document.getElementById('generatedPassword');
    const passwordResult = document.getElementById('password-result');
    const copyPassword = document.getElementById('copyPassword');
    const passwordStrengthMeter = document.getElementById('password-strength-meter');
    const passwordStrengthText = document.getElementById('password-strength-text');
    const passwordFeedback = document.getElementById('password-feedback');
    
    // Passphrase Generator
    const passphraseForm = document.getElementById('passphrase-generator-form');
    const wordCount = document.getElementById('wordCount');
    const wordCountValue = document.getElementById('wordCountValue');
    const separator = document.getElementById('separator');
    const capitalizeWords = document.getElementById('capitalizeWords');
    const includeNumber = document.getElementById('includeNumber');
    const generatedPassphrase = document.getElementById('generatedPassphrase');
    const passphraseResult = document.getElementById('passphrase-result');
    const copyPassphrase = document.getElementById('copyPassphrase');
    const passphraseStrengthMeter = document.getElementById('passphrase-strength-meter');
    const passphraseStrengthText = document.getElementById('passphrase-strength-text');
    const passphraseFeedback = document.getElementById('passphrase-feedback');
    
    // Password Leak Check
    const passwordLeakForm = document.getElementById('password-leak-form');
    const passwordToCheck = document.getElementById('passwordToCheck');
    const passwordLeakResult = document.getElementById('password-leak-result');
    
    // Email Leak Check
    const emailLeakForm = document.getElementById('email-leak-form');
    const emailToCheck = document.getElementById('emailToCheck');
    const emailLeakResult = document.getElementById('email-leak-result');
    
    // Update password length display
    passwordLength.addEventListener('input', function() {
        passwordLengthValue.textContent = this.value;
    });
    
    // Update word count display
    wordCount.addEventListener('input', function() {
        wordCountValue.textContent = this.value;
    });
    
    // Password Generator Form Submission
    passwordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Ensure at least one character type is selected
        if (!includeUppercase.checked && !includeLowercase.checked && 
            !includeNumbers.checked && !includeSymbols.checked) {
            alert('Please select at least one character type');
            return;
        }
        
        // Prepare the request
        const formData = new FormData();
        formData.append('length', passwordLength.value);
        formData.append('include_uppercase', includeUppercase.checked);
        formData.append('include_lowercase', includeLowercase.checked);
        formData.append('include_numbers', includeNumbers.checked);
        formData.append('include_symbols', includeSymbols.checked);
        
        // Show loading state
        passwordResult.style.display = 'block';
        generatedPassword.value = 'Generating...';
        passwordStrengthMeter.querySelector('.progress-bar').style.width = '0%';
        passwordStrengthMeter.querySelector('.progress-bar').className = 'progress-bar';
        passwordStrengthText.textContent = '';
        passwordFeedback.innerHTML = '';
        
        // Send the request
        fetch('/api/generate-password', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                throw new Error(data.error);
            }
            
            // Display the generated password
            generatedPassword.value = data.password;
            
            // Update strength meter
            let strengthPercent = 0;
            let strengthClass = 'bg-danger';
            
            switch (data.strength) {
                case 'weak':
                    strengthPercent = 25;
                    strengthClass = 'bg-danger';
                    break;
                case 'moderate':
                    strengthPercent = 50;
                    strengthClass = 'bg-warning';
                    break;
                case 'good':
                    strengthPercent = 75;
                    strengthClass = 'bg-info';
                    break;
                case 'strong':
                    strengthPercent = 100;
                    strengthClass = 'bg-success';
                    break;
            }
            
            passwordStrengthMeter.querySelector('.progress-bar').style.width = `${strengthPercent}%`;
            passwordStrengthMeter.querySelector('.progress-bar').className = `progress-bar ${strengthClass}`;
            passwordStrengthText.textContent = `Password Strength: ${data.strength.charAt(0).toUpperCase() + data.strength.slice(1)}`;
            
            // Display feedback
            if (data.feedback && data.feedback.length > 0) {
                const feedbackHtml = data.feedback.map(item => `<div><i class="fas fa-info-circle text-info me-1"></i> ${item}</div>`).join('');
                passwordFeedback.innerHTML = feedbackHtml;
            } else {
                passwordFeedback.innerHTML = '';
            }
        })
        .catch(error => {
            generatedPassword.value = '';
            passwordFeedback.innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
        });
    });
    
    // Passphrase Generator Form Submission
    passphraseForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Prepare the request
        const formData = new FormData();
        formData.append('num_words', wordCount.value);
        formData.append('separator', separator.value);
        formData.append('capitalize', capitalizeWords.checked);
        formData.append('include_number', includeNumber.checked);
        
        // Show loading state
        passphraseResult.style.display = 'block';
        generatedPassphrase.value = 'Generating...';
        passphraseStrengthMeter.querySelector('.progress-bar').style.width = '0%';
        passphraseStrengthMeter.querySelector('.progress-bar').className = 'progress-bar';
        passphraseStrengthText.textContent = '';
        passphraseFeedback.innerHTML = '';
        
        // Send the request
        fetch('/api/generate-passphrase', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                throw new Error(data.error);
            }
            
            // Display the generated passphrase
            generatedPassphrase.value = data.passphrase;
            
            // Update strength meter
            let strengthPercent = 0;
            let strengthClass = 'bg-danger';
            
            switch (data.strength) {
                case 'weak':
                    strengthPercent = 25;
                    strengthClass = 'bg-danger';
                    break;
                case 'moderate':
                    strengthPercent = 50;
                    strengthClass = 'bg-warning';
                    break;
                case 'good':
                    strengthPercent = 75;
                    strengthClass = 'bg-info';
                    break;
                case 'strong':
                    strengthPercent = 100;
                    strengthClass = 'bg-success';
                    break;
            }
            
            passphraseStrengthMeter.querySelector('.progress-bar').style.width = `${strengthPercent}%`;
            passphraseStrengthMeter.querySelector('.progress-bar').className = `progress-bar ${strengthClass}`;
            passphraseStrengthText.textContent = `Passphrase Strength: ${data.strength.charAt(0).toUpperCase() + data.strength.slice(1)}`;
            
            // Display feedback
            if (data.feedback && data.feedback.length > 0) {
                const feedbackHtml = data.feedback.map(item => `<div><i class="fas fa-info-circle text-info me-1"></i> ${item}</div>`).join('');
                passphraseFeedback.innerHTML = feedbackHtml;
            } else {
                passphraseFeedback.innerHTML = '';
            }
        })
        .catch(error => {
            generatedPassphrase.value = '';
            passphraseFeedback.innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
        });
    });
    
    // Password Leak Check Form Submission
    passwordLeakForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!passwordToCheck.value) {
            return;
        }
        
        // Prepare the request
        const formData = new FormData();
        formData.append('password', passwordToCheck.value);
        
        // Show loading state
        passwordLeakResult.style.display = 'block';
        passwordLeakResult.innerHTML = `
            <div class="text-center">
                <div class="spinner-border text-danger" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p>Checking password security...</p>
            </div>
        `;
        
        // Send the request
        fetch('/api/check-leaked-password', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                throw new Error(data.error);
            }
            
            // Display the result
            let resultHtml = '';
            
            if (data.is_leaked) {
                resultHtml = `
                    <div class="alert alert-danger">
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i> Password Found in Data Breaches!</h5>
                        <p>${data.message}</p>
                        <hr>
                        <p class="mb-0">Recommendation: Change this password immediately for any accounts where you use it.</p>
                    </div>
                `;
            } else {
                resultHtml = `
                    <div class="alert alert-success">
                        <h5 class="alert-heading"><i class="fas fa-check-circle me-2"></i> Good News!</h5>
                        <p>${data.message}</p>
                        <hr>
                        <p class="mb-0">Remember to use unique passwords for each account and change them regularly.</p>
                    </div>
                `;
            }
            
            passwordLeakResult.innerHTML = resultHtml;
        })
        .catch(error => {
            passwordLeakResult.innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
        });
    });
    
    // Email Leak Check Form Submission
    emailLeakForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!emailToCheck.value) {
            return;
        }
        
        // Prepare the request
        const formData = new FormData();
        formData.append('email', emailToCheck.value);
        
        // Show loading state
        emailLeakResult.style.display = 'block';
        emailLeakResult.innerHTML = `
            <div class="text-center">
                <div class="spinner-border text-danger" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p>Checking email security...</p>
            </div>
        `;
        
        // Send the request
        fetch('/api/check-leaked-email', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                throw new Error(data.error);
            }
            
            // Display the result
            let resultHtml = '';
            
            if (data.is_leaked) {
                resultHtml = `
                    <div class="alert alert-danger">
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i> Email Found in Data Breaches!</h5>
                        <p>${data.message}</p>
                `;
                
                if (data.breaches && data.breaches.length > 0) {
                    resultHtml += `<p>This email was found in these breaches:</p><ul>`;
                    data.breaches.forEach(breach => {
                        resultHtml += `
                            <li><strong>${breach.name}</strong> (${breach.breach_date})
                                <br><small>Data exposed: ${breach.data_types.join(', ')}</small>
                            </li>
                        `;
                    });
                    resultHtml += `</ul>`;
                }
                
                resultHtml += `
                        <hr>
                        <p class="mb-0">Recommendation: Change passwords for all accounts using this email, especially if you reuse passwords.</p>
                    </div>
                `;
            } else {
                resultHtml = `
                    <div class="alert alert-success">
                        <h5 class="alert-heading"><i class="fas fa-check-circle me-2"></i> Good News!</h5>
                        <p>${data.message}</p>
                        <hr>
                        <p class="mb-0">Remember to use unique passwords for each account and enable two-factor authentication when possible.</p>
                    </div>
                `;
            }
            
            emailLeakResult.innerHTML = resultHtml;
        })
        .catch(error => {
            emailLeakResult.innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
        });
    });
    
    // Copy password button
    copyPassword.addEventListener('click', function() {
        generatedPassword.select();
        document.execCommand('copy');
        
        // Show copied indicator
        const originalText = this.innerHTML;
        this.innerHTML = '<i class="fas fa-check"></i>';
        this.classList.add('btn-success');
        
        setTimeout(() => {
            this.innerHTML = originalText;
            this.classList.remove('btn-success');
        }, 1500);
    });
    
    // Copy passphrase button
    copyPassphrase.addEventListener('click', function() {
        generatedPassphrase.select();
        document.execCommand('copy');
        
        // Show copied indicator
        const originalText = this.innerHTML;
        this.innerHTML = '<i class="fas fa-check"></i>';
        this.classList.add('btn-success');
        
        setTimeout(() => {
            this.innerHTML = originalText;
            this.classList.remove('btn-success');
        }, 1500);
    });
});
</script>
{% endblock %}